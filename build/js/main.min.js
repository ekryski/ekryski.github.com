!function(t){"use strict";t.fn.counterUp=function(e){var n=t.extend({time:400,delay:10},e);return this.each(function(){var e=t(this),u=n,a=function(){var t=[],n=u.time/u.delay,a=e.text(),r=/[0-9]+,[0-9]+/.test(a);a=a.replace(/,/g,"");for(var o=(/^[0-9]+$/.test(a),/^[0-9]+\.[0-9]+$/.test(a)),c=o?(a.split(".")[1]||[]).length:0,i=n;i>=1;i--){var s=parseInt(a/n*i);if(o&&(s=parseFloat(a/n*i).toFixed(c)),r)for(;/(\d+)(\d{3})/.test(s.toString());)s=s.toString().replace(/(\d+)(\d{3})/,"$1,$2");t.unshift(s)}e.data("counterup-nums",t),e.text("0");var d=function(){e.text(e.data("counterup-nums").shift()),e.data("counterup-nums").length?setTimeout(e.data("counterup-func"),u.delay):(delete e.data("counterup-nums"),e.data("counterup-nums",null),e.data("counterup-func",null))};e.data("counterup-func",d),setTimeout(e.data("counterup-func"),u.delay)};e.waypoint(a,{offset:"100%",triggerOnce:!0})})}}(jQuery);
var Site={markers:[[-114.063096,51.044473],[126.97822,37.564828],[126.525458,33.501368],[-.123915,51.509628],[4.894668,52.370628],[4.407795,51.220529],[-.364333,49.174495],[-155.997126,19.657635],[-86.850173,21.16195],[-9.15554,38.760701],[-5.969505,37.385631],[1.248513,41.127138],[2.171365,41.391419],[-87.626069,41.877972],[11.582519,48.134866],[11.434393,48.263618],[9.182195,48.780252],[6.973943,50.946821],[4.348211,50.863684],[9.184438,45.466117],[7.265692,43.696365],[5.364284,43.296135],[1.450404,43.598729],[-.576573,44.838768],[2.356776,48.859688],[-81.382826,28.536982],[-73.966674,40.780284],[-123.085967,49.311958],[-71.243419,46.804689],[-97.138835,49.899621],[-106.681574,52.133438],[-119.498265,49.910085],[-87.913528,43.038071],[-122.678798,45.522475],[-157.86094,21.307119],[-117.426398,47.658852]],init:function(){this.$modal=$(".player-modal"),this.$triangles=$(".triangle"),this.seenProjects=!1,this.seenLocation=!1,window.onYouTubeIframeAPIReady=this.onYouTubeIframeAPIReady,$(window).on("scroll",$.proxy(this.checkWaypoints,this)),$("a.play").click($.proxy(this.playVideo,this)),$("a.close").click($.proxy(this.stopVideo,this)),$("a.show-travels").click($.proxy(this.startTraveling,this)),$(".triangle a").mouseenter(this.toggleExpansion),$(".triangle a").mouseleave(this.toggleExpansion),this.startCounting()},checkWaypoints:function(){var t=window.pageYOffset,e=300;!this.seenProjects&&t>$("section.projects").offset().top-e&&(this.seenProjects=!0,this.highlightHexagon()),!this.seenLocation&&t>$("section.location").offset().top-e&&(this.seenLocation=!0,this.loadYoutube(),this.insertMap())},startCounting:function(){$(".counter").counterUp({delay:10,time:1500})},toggleExpansion:function(){$(this).parent().toggleClass("active expanded")},highlightHexagon:function(){var t=this,e=["top","top-right","bottom-right","bottom","bottom-left","top-left"];this.$triangles.removeClass("expanded"),setTimeout(function(){t.$triangles.each(function(i){setTimeout(function(){t.$triangles.removeClass("active"),$(".triangle."+e[i]).addClass("active")},200*i),setTimeout(function(){t.$triangles.removeClass("active")},200*(t.$triangles.length+1))})},300)},loadYoutube:function(){var t=document.createElement("script");t.src="//www.youtube.com/iframe_api";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)},onPlayerReady:function(t){t.target.playVideo()},playVideo:function(t){return t.preventDefault(),this.$modal.removeClass("hidden"),this.player?void this.player.playVideo():void(this.player=new YT.Player("player",{height:"390",width:"640",videoId:"L82_jHs8FgA",events:{onReady:$.proxy(this.onPlayerReady,this)}}))},stopVideo:function(t){t.preventDefault(),this.player.stopVideo(),this.$modal.addClass("hidden")},onYouTubeIframeAPIReady:function(){},insertMap:function(){var t=this;this.map=L.mapbox.map("map","ekryski.i0naei2f").setView([51.044473,-114.063096],12),this.plotMarkers(),this.map.featureLayer.on("click",function(e){t.map.panTo(e.layer.getLatLng())})},plotMarkers:function(){for(var t=0;t<this.markers.length;t++){var e={type:"Feature",geometry:{type:"Point",coordinates:this.markers[t]},properties:{"marker-size":"medium","marker-color":"#E25667","marker-symbol":"star"}};L.mapbox.featureLayer(e).addTo(this.map)}},startTraveling:function(){this.map.panTo({lat:48.859688,lng:2.356776}),this.map.setZoom(2)}};$(document).ready(function(){Site.init()});